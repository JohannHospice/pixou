<head>
  <script src="https://cdn.plot.ly/plotly-2.9.0.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body {
      margin: 0;
    }
    #gd {
      width: 100%;
      height: 100%;
    }
  </style>
  <title>Plot renderer</title>
</head>
<body>
  <div id="gd"></div>
  <script>
    openSocket();
    updatePlot();

    function openSocket() {
      const socket = io();

      socket.on("update", (msg) => {
        console.log("Message from server ", msg);
        updatePlot();
      });
    }

    function updatePlot() {
      const d1 = new Date()
      setInterval(() => {
        const d2 = new Date();
        window.document.title = Math.floor((d2 - d1.getTime()) / 1000 )+ "s Yeah buddy !";
      }, 1000);
      
      fetch("/plot.json")
        .then((response) => response.json())
        .then((data) =>
          Plotly.newPlot("gd", {
            ...data,
            config: { responsive: true },
          })
        )
        .then((plot) => {
          plot.on("plotly_hover", function (eventdata) {
            Plotly.Fx.hover(
              plot,
              { xval: eventdata.xvals[0] },
              Object.keys(plot._fullLayout._plots)
            );
          });
        });
    }
  </script>
</body>
